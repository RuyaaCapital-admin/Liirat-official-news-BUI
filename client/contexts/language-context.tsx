import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';

export type Language = 'ar' | 'en';

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string, fallback?: string) => string;
  dir: 'rtl' | 'ltr';
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

// Translation keys
const translations = {
  ar: {
    // Navigation
    'nav.calendar': 'ุงูุชูููู ุงูุงูุชุตุงุฏู',
    'nav.alerts': 'ุงูุชูุจููุงุช',
    'nav.about': 'ุญูู ููุฑุงุช',
    'nav.contact': 'ุชูุงุตู ูุนูุง',
    'nav.notifications': 'ุงูุชูุจููุงุช',
    'nav.theme': 'ุชุจุฏูู ุงููุธูุฑ',
    'nav.tour': 'ุจุฏุก ุฌููุฉ ุงููููุน',
    
    // Hero Section
    'hero.title': 'ุฃุฎุจุงุฑ ูุงููุฉ ูุงูุชุตุงุฏูุฉ',
    'hero.subtitle': 'ุฏูููุฉ ููุญุฏุซุฉ',
    'hero.description': 'ููุตุฉ ููุฑุงุช ููุฃุฎุจุงุฑ ุงููุงููุฉ - ุชูููู ุงูุชุตุงุฏู ูุจุงุดุฑุ ุชูุจููุงุช ููุฑูุฉุ ูุชุญูููุงุช ูุชูุฏูุฉ ูุฌููุน ุงูุฃุณูุงู ุงูุนุงูููุฉ',
    'hero.btn.calendar': 'ุงุทูุน ุนูู ุงูุชูููู',
    'hero.btn.alerts': 'ุฅุนุฏุงุฏ ุงูุชูุจููุงุช',
    
    // Economic Calendar
    'calendar.title': 'ุงูุชูููู ุงูุงูุชุตุงุฏู ุงููุจุงุดุฑ',
    'calendar.description': 'ุชุงุจุน ุฃูู ุงูุฃุญุฏุงุซ ุงูุงูุชุตุงุฏูุฉ ูุงููุคุดุฑุงุช ุงููุงููุฉ ูู ุงูููุช ุงููุนูู ูุน ุฅููุงููุงุช ุชุตููุฉ ูุชูุฏูุฉ',
    'calendar.filters.title': 'ููุงุชุฑ ุงูุชูููู ุงูุงูุชุตุงุฏู',
    'calendar.filters.date': 'ุงูุชุงุฑูุฎ',
    'calendar.filters.currency': 'ุงูุนููุฉ/ุงูุจูุฏ',
    'calendar.filters.importance': 'ูุณุชูู ุงูุฃูููุฉ',
    'calendar.filters.search': 'ุงูุจุญุซ ูู ุงูุฃุญุฏุงุซ',
    'calendar.filters.search.placeholder': 'ุงุจุญุซ ุนู ุญุฏุซ...',
    'calendar.table.datetime': 'ุงูุชุงุฑูุฎ ูุงูููุช',
    'calendar.table.country': 'ุงูุนููุฉ/ุงูุจูุฏ',
    'calendar.table.importance': 'ุงูุฃูููุฉ',
    'calendar.table.event': 'ุงูุญุฏุซ',
    'calendar.table.actual': 'ุงููููุฉ ุงููุนููุฉ',
    'calendar.table.forecast': 'ุงูุชููุน',
    'calendar.table.previous': 'ุงูุณุงุจู',
    'calendar.table.analysis': 'ุชุญููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู',
    'calendar.live.badge': 'ุชุญุฏูุซ ูุจุงุดุฑ',
    'calendar.events.count': '{count} ูู ุฃุตู {total} ุญุฏุซ',
    'calendar.events.update': 'ุงูุจูุงูุงุช ูุญุฏุซุฉ ูู ุฏูููุฉ ูู ูุตุงุฏุฑ ููุซููุฉ',
    'calendar.upcoming': 'ูุฑูุจุงู',
    
    // Alerts Section
    'alerts.title': 'ูุธุงู ุงูุชูุจููุงุช ุงูุฐูู',
    'alerts.description': 'ุงุญุตู ุนูู ุชูุจููุงุช ููุฑูุฉ ุนูุฏ ุตุฏูุฑ ุงูุจูุงูุงุช ุงูุงูุชุตุงุฏูุฉ ุงููููุฉ',
    'alerts.setup.title': 'ุฅุนุฏุงุฏ ุงูุชูุจููุงุช',
    'alerts.select.pair': 'ุงุฎุชุฑ ุฒูุฌ ุงูุนููุฉ ุฃู ุงููุคุดุฑ',
    'alerts.select.placeholder': 'ุงุฎุชุฑ ูู ุงููุงุฆูุฉ',
    'alerts.btn.submit': 'ุฃุฑุณู ูู ุชูุจููุงุช',
    'alerts.info': 'ุณูุชู ุฅุฑุณุงู ุงูุชูุจููุงุช ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุงููุงุชุณุงุจ',
    'alerts.types.title': 'ุฃููุงุน ุงูุชูุจููุงุช ุงููุชุงุญุฉ:',
    'alerts.types.high': 'ุจูุงูุงุช ุงูุชุตุงุฏูุฉ ุนุงููุฉ ุงูุชุฃุซูุฑ',
    'alerts.types.central': 'ูุฑุงุฑุงุช ุงูุจููู ุงููุฑูุฒูุฉ',
    'alerts.types.unexpected': 'ุชุญุฑูุงุช ุบูุฑ ูุชููุนุฉ ูู ุงูุฃุณูุงู',
    'alerts.types.rates': 'ุชุญุฏูุซุง๏ฟฝ๏ฟฝ ุฃุณุนุงุฑ ุงููุงุฆุฏุฉ',
    'alerts.status': 'ุณูุชู ุชูุนูู ุงูุชูุจููุงุช ูุงุญูุงู',
    
    // About Section
    'about.title': 'ููุงุฐุง ููุฑุงุช ูููุฒุ',
    'about.description': 'ููุตุชู ุงูููุซููุฉ ููุฃุฎุจุงุฑ ุงููุงููุฉ ูุงูุชุญูููุงุช ุงูุงูุชุตุงุฏูุฉ',
    'about.realtime.title': 'ุชุญุฏูุซุงุช ููุฑูุฉ',
    'about.realtime.desc': 'ุจูุงูุงุช ูุญุฏุซุฉ ูู ุฏูููุฉ ูู ุงูุฃุณูุงู ุงูุนุงูููุฉ',
    'about.analysis.title': 'ุชุญูููุงุช ูุชูุฏูุฉ',
    'about.analysis.desc': 'ุชุญูููุงุช ุนูููุฉ ููุฃุญุฏุงุซ ุงูุงูุชุตุงุฏูุฉ',
    'about.sources.title': 'ูุตุงุฏุฑ ููุซููุฉ',
    'about.sources.desc': 'ูู ุงูุจููู ุงููุฑูุฒูุฉ ูุงููุคุณุณุงุช ุงููุงููุฉ ุงูุฑุณููุฉ',
    'about.coverage.title': 'ุชุบุทูุฉ ุนุงูููุฉ',
    'about.coverage.desc': 'ุฌููุน ุงูุฃุณูุงู ูุงูุนููุงุช ๏ฟฝ๏ฟฝูุฑุฆูุณูุฉ',
    
    // Contact Section
    'contact.title': 'ุชูุงุตู ูุน ูุฑูู ููุฑุงุช',
    'contact.description': 'ููุงุณุชูุณุงุฑุงุช ูุงูุฏุนู ุงูููู',
    'contact.form.name': 'ุงู๏ฟฝ๏ฟฝุณู ุงููุงูู',
    'contact.form.name.placeholder': 'ุฃุฏุฎู ุงุณูู ุงููุงูู',
    'contact.form.email': 'ุงูุจุฑูุฏ ุงูุฅููุชุฑููู',
    'contact.form.email.placeholder': 'example@email.com',
    'contact.form.whatsapp': 'ุฑูู ุงููุงุชุณุงุจ',
    'contact.form.whatsapp.placeholder': '+966xxxxxxxxx',
    'contact.form.submit': 'ุฅุฑุณุงู ุฑุณุงูุฉ',
    
    // Footer
    'footer.description': 'ููุตุฉ ููุฑุงุช ููุฃุฎุจุงุฑ ุงููุงููุฉ ูุงูุงูุชุตุงุฏูุฉ',
    'footer.privacy': 'ุณูุงุณุฉ ุงูุฎุตูุตูุฉ',
    'footer.terms': 'ุดุฑูุท ุงูุงุณุชุฎุฏุงู',
    'footer.contact': 'ุชูุงุตู ูุนูุง',
    'footer.tour': 'ุฌููุฉ ุงููููุน',
    'footer.copyright': 'ยฉ 2024 Liirat News. ุฌููุน ุงูุญููู ูุญููุธุฉ.',
    
    // AI Analysis
    'ai.button': 'ุชุญููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู',
    'ai.title': 'ุชุญููู ุฐูู ููุญุฏุซ ุงูุงูุชุตุงุฏู',
    'ai.description': 'ุชุญููู ูุฏุนูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุญุฏุซ ุงูุงูุชุตุงุฏู ูุชุฃุซูุฑู ุนูู ุงูุฃุณูุงู',
    'ai.loading': 'ุฌุงุฑู ุชุญููู ุงูุญุฏุซ ุงูุงูุชุตุงุฏู...',
    'ai.loading.desc': 'ูุฏ ูุณุชุบุฑู ูุฐุง ุจุถุน ุซูุงู',
    'ai.error.title': 'ุฎุทุฃ ูู ุงูุญุตูู ุนูู ุงูุชุญููู',
    'ai.retry': 'ุฅุนุงุฏุฉ ุงููุญุงููุฉ',
    'ai.analysis.title': 'ุงูุชุญููู ุงูุฐูู',
    'ai.powered': 'ูุฏุนูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู',
    'ai.importance': 'ุฃูููุฉ',
    'ai.actual': 'ุงููุนูู',
    'ai.forecast': 'ุงููุชููุน',
    'ai.previous': 'ุงูุณุงุจู',
    
    // Date/Time Options
    'date.today': 'ุงูููู',
    'date.tomorrow': 'ุบุฏุงู',
    'date.thisweek': 'ูุฐุง ุงูุฃุณุจูุน',
    'date.nextweek': 'ุงูุฃุณุจูุน ุงููุงุฏู',
    'date.custom': 'ุชุงุฑูุฎ ูุฎุตุต',
    
    // Importance Levels
    'importance.all': 'ุฌููุน ุงููุณุชููุงุช',
    'importance.high': 'โญโญโญ ุนุงูู ุงูุชุฃุซูุฑ',
    'importance.medium': 'โญโญ ูุชูุณุท ุงูุชุฃุซูุฑ',
    'importance.low': 'โญ ููุฎูุถ ุงูุชุฃุซูุฑ',
    
    // Currency Options
    'currency.all': 'ุฌููุน ุงูุนููุงุช',
    'currency.usd': '๐บ๐ธ USD - ุงูุฏููุงุฑ ุงูุฃูุฑููู',
    'currency.eur': '๐ช๐บ EUR - ุงูููุฑู',
    'currency.gbp': '๐ฌ๐ง GBP - ุงูุฌููู ุงูุฅุณุชุฑูููู',
    'currency.jpy': '๐ฏ๐ต JPY - ุงููู ุงููุงุจุงูู',
    'currency.aud': '๐ฆ๐บ AUD - ุงูุฏููุงุฑ ุงูุฃุณุชุฑุงูู',
    'currency.cad': '๐จ๐ฆ CAD - ุงูุฏููุงุฑ ุงูููุฏู',

    // Calendar placeholders and labels
    'calendar.select.date': 'ุงุฎุชุฑ ุงูุชุงุฑูุฎ',
    'calendar.select.currency': 'ุฌููุน ุงูุนููุงุช',
    'calendar.select.importance': 'ุฌููุน ุงููุณุชููุงุช',

    // Alert pairs
    'alert.pairs.eurusd': 'EUR/USD',
    'alert.pairs.gbpusd': 'GBP/USD',
    'alert.pairs.usdjpy': 'USD/JPY',
    'alert.pairs.usdcad': 'USD/CAD',
    'alert.pairs.audusd': 'AUD/USD',
    'alert.pairs.nfp': 'ุฑูุงุชุจ ุบูุฑ ุงูุฒุฑุงุนูุฉ ุงูุฃูุฑูููุฉ',
    'alert.pairs.cpi': 'ูุคุดุฑ ุฃุณุนุงุฑ ุงููุณุชููู',
    'alert.pairs.gdp': 'ุงููุงุชุฌ ุงููุญูู ุงูุฅุฌูุงูู',

    // Error messages
    'error.loading': 'ุฎุทุฃ ูู ุงูุชุญููู',
    'error.retry': 'ุฅุนุงุฏุฉ ุงููุญุงููุฉ',
    'error.network': 'ุฎุทุฃ ูู ุงูุดุจูุฉ',

    // Common actions
    'common.loading': 'ุฌุงุฑู ุงูุชุญููู...',
    'common.save': 'ุญูุธ',
    'common.cancel': 'ุฅูุบุงุก',
    'common.close': 'ุฅุบูุงู',
    'common.edit': 'ุชุนุฏูู',
    'common.delete': 'ุญุฐู',
    'common.add': 'ุฅุถุงูุฉ',
    'common.select': 'ุงุฎุชูุงุฑ',
    'common.confirm': 'ุชุฃููุฏ',

    // Notification system
    'notifications.title': 'ุงูุชูุจููุงุช',
    'notifications.empty': 'ูุง ุชูุฌุฏ ุชูุจููุงุช',
    'notifications.mark_read': 'ุชุญุฏูุฏ ูููุฑูุก',
    'notifications.clear_all': 'ูุณุญ ุงููู',
    'notifications.settings': 'ุฅุนุฏุงุฏุงุช ุงูุชูุจููุงุช',
  },
  en: {
    // Navigation
    'nav.calendar': 'Economic Calendar',
    'nav.alerts': 'Alerts',
    'nav.about': 'About Liirat',
    'nav.contact': 'Contact Us',
    'nav.notifications': 'Notifications',
    'nav.theme': 'Toggle Theme',
    'nav.tour': 'Start Site Tour',
    
    // Hero Section
    'hero.title': 'Financial & Economic News',
    'hero.subtitle': 'Accurate and Updated',
    'hero.description': 'Liirat Financial News Platform - Live economic calendar, instant alerts, and advanced analysis for all global markets',
    'hero.btn.calendar': 'View Calendar',
    'hero.btn.alerts': 'Setup Alerts',
    
    // Economic Calendar
    'calendar.title': 'Live Economic Calendar',
    'calendar.description': 'Follow the most important economic events and financial indicators in real-time with advanced filtering capabilities',
    'calendar.filters.title': 'Economic Calendar Filters',
    'calendar.filters.date': 'Date',
    'calendar.filters.currency': 'Currency/Country',
    'calendar.filters.importance': 'Importance Level',
    'calendar.filters.search': 'Search Events',
    'calendar.filters.search.placeholder': 'Search for an event...',
    'calendar.table.datetime': 'Date & Time',
    'calendar.table.country': 'Currency/Country',
    'calendar.table.importance': 'Importance',
    'calendar.table.event': 'Event',
    'calendar.table.actual': 'Actual Value',
    'calendar.table.forecast': 'Forecast',
    'calendar.table.previous': 'Previous',
    'calendar.table.analysis': 'AI Analysis',
    'calendar.live.badge': 'Live Update',
    'calendar.events.count': '{count} out of {total} events',
    'calendar.events.update': 'Data updated every minute from reliable sources',
    'calendar.upcoming': 'Coming Soon',
    
    // Alerts Section
    'alerts.title': 'Smart Alert System',
    'alerts.description': 'Get instant notifications when important economic data is released',
    'alerts.setup.title': 'Setup Alerts',
    'alerts.select.pair': 'Choose Currency Pair or Index',
    'alerts.select.placeholder': 'Select from list',
    'alerts.btn.submit': 'Send Me Alerts',
    'alerts.info': 'Alerts will be sent via email and WhatsApp',
    'alerts.types.title': 'Available Alert Types:',
    'alerts.types.high': 'High-impact economic data',
    'alerts.types.central': 'Central bank decisions',
    'alerts.types.unexpected': 'Unexpected market movements',
    'alerts.types.rates': 'Interest rate updates',
    'alerts.status': 'Alerts will be activated later',
    
    // About Section
    'about.title': 'Why Liirat News?',
    'about.description': 'Your trusted platform for financial news and economic analysis',
    'about.realtime.title': 'Real-time Updates',
    'about.realtime.desc': 'Data updated every minute from global markets',
    'about.analysis.title': 'Advanced Analysis',
    'about.analysis.desc': 'Deep insights into economic events',
    'about.sources.title': 'Reliable Sources',
    'about.sources.desc': 'From central banks and official financial institutions',
    'about.coverage.title': 'Global Coverage',
    'about.coverage.desc': 'All major markets and currencies',
    
    // Contact Section
    'contact.title': 'Contact Liirat Team',
    'contact.description': 'For inquiries and technical support',
    'contact.form.name': 'Full Name',
    'contact.form.name.placeholder': 'Enter your full name',
    'contact.form.email': 'Email Address',
    'contact.form.email.placeholder': 'example@email.com',
    'contact.form.whatsapp': 'WhatsApp Number',
    'contact.form.whatsapp.placeholder': '+966xxxxxxxxx',
    'contact.form.submit': 'Send Message',
    
    // Footer
    'footer.description': 'Liirat Financial and Economic News Platform',
    'footer.privacy': 'Privacy Policy',
    'footer.terms': 'Terms of Use',
    'footer.contact': 'Contact Us',
    'footer.tour': 'Site Tour',
    'footer.copyright': 'ยฉ 2024 Liirat News. All rights reserved.',
    
    // AI Analysis
    'ai.button': 'AI Analysis',
    'ai.title': 'Smart Economic Event Analysis',
    'ai.description': 'AI-powered analysis of economic events and their market impact',
    'ai.loading': 'Analyzing economic event...',
    'ai.loading.desc': 'This may take a few seconds',
    'ai.error.title': 'Error getting analysis',
    'ai.retry': 'Retry',
    'ai.analysis.title': 'Smart Analysis',
    'ai.powered': 'Powered by AI',
    'ai.importance': 'Importance',
    'ai.actual': 'Actual',
    'ai.forecast': 'Forecast',
    'ai.previous': 'Previous',
    
    // Date/Time Options
    'date.today': 'Today',
    'date.tomorrow': 'Tomorrow',
    'date.thisweek': 'This Week',
    'date.nextweek': 'Next Week',
    'date.custom': 'Custom Date',
    
    // Importance Levels
    'importance.all': 'All Levels',
    'importance.high': 'โญโญโญ High Impact',
    'importance.medium': 'โญโญ Medium Impact',
    'importance.low': 'โญ Low Impact',
    
    // Currency Options
    'currency.all': 'All Currencies',
    'currency.usd': '๐บ๐ธ USD - US Dollar',
    'currency.eur': '๐ช๐บ EUR - Euro',
    'currency.gbp': '๐ฌ๐ง GBP - British Pound',
    'currency.jpy': '๐ฏ๐ต JPY - Japanese Yen',
    'currency.aud': '๐ฆ๐บ AUD - Australian Dollar',
    'currency.cad': '๐จ๐ฆ CAD - Canadian Dollar',

    // Calendar placeholders and labels
    'calendar.select.date': 'Select Date',
    'calendar.select.currency': 'All Currencies',
    'calendar.select.importance': 'All Levels',

    // Alert pairs
    'alert.pairs.eurusd': 'EUR/USD',
    'alert.pairs.gbpusd': 'GBP/USD',
    'alert.pairs.usdjpy': 'USD/JPY',
    'alert.pairs.usdcad': 'USD/CAD',
    'alert.pairs.audusd': 'AUD/USD',
    'alert.pairs.nfp': 'US Non-Farm Payrolls',
    'alert.pairs.cpi': 'Consumer Price Index',
    'alert.pairs.gdp': 'Gross Domestic Product',

    // Error messages
    'error.loading': 'Loading Error',
    'error.retry': 'Retry',
    'error.network': 'Network Error',

    // Common actions
    'common.loading': 'Loading...',
    'common.save': 'Save',
    'common.cancel': 'Cancel',
    'common.close': 'Close',
    'common.edit': 'Edit',
    'common.delete': 'Delete',
    'common.add': 'Add',
    'common.select': 'Select',
    'common.confirm': 'Confirm',

    // Notification system
    'notifications.title': 'Notifications',
    'notifications.empty': 'No notifications',
    'notifications.mark_read': 'Mark as read',
    'notifications.clear_all': 'Clear all',
    'notifications.settings': 'Notification Settings',
  }
};

interface LanguageProviderProps {
  children: ReactNode;
}

export function LanguageProvider({ children }: LanguageProviderProps) {
  const [language, setLanguageState] = useState<Language>('ar');

  // Initialize language from localStorage or browser preference
  useEffect(() => {
    const savedLanguage = localStorage.getItem('liirat-language') as Language;
    if (savedLanguage && (savedLanguage === 'ar' || savedLanguage === 'en')) {
      setLanguageState(savedLanguage);
    } else {
      // Auto-detect from browser/content
      const htmlDir = document.documentElement.getAttribute('dir');
      if (htmlDir === 'rtl') {
        setLanguageState('ar');
      } else if (htmlDir === 'ltr') {
        setLanguageState('en');
      } else {
        // Check for Arabic content
        const hasArabicText = document.body.textContent?.includes('ุงูุชูููู') || 
                             document.body.textContent?.includes('ููุฑุงุช');
        setLanguageState(hasArabicText ? 'ar' : 'en');
      }
    }
  }, []);

  // Update HTML attributes and save preference when language changes
  useEffect(() => {
    document.documentElement.setAttribute('lang', language);
    document.documentElement.setAttribute('dir', language === 'ar' ? 'rtl' : 'ltr');
    localStorage.setItem('liirat-language', language);
  }, [language]);

  const setLanguage = (lang: Language) => {
    setLanguageState(lang);
  };

  const t = (key: string, fallback?: string): string => {
    const translation = translations[language]?.[key as keyof typeof translations[typeof language]];
    return translation || fallback || key;
  };

  return (
    <LanguageContext.Provider value={{
      language,
      setLanguage,
      t,
      dir: language === 'ar' ? 'rtl' : 'ltr'
    }}>
      {children}
    </LanguageContext.Provider>
  );
}

export function useLanguage() {
  const context = useContext(LanguageContext);
  if (context === undefined) {
    throw new Error('useLanguage must be used within a LanguageProvider');
  }
  return context;
}
